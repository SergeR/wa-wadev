<div class="block padded">
    <p class="wadev-balance">[`Current account balance`]: <b>{$balance.balance|wa_currency_html:$balance.currency}</b>. {if !empty($balance['error'])}<br><span class="error">{$balance.error}</span>{/if}</p>
    <div class="content-header">
        <h1>[`Transactions`]</h1>
    </div>

    <!--<a href="#" class="button green" data-wadev-action="update-transactions">[`Update`]</a>-->

    <form method="get" class="wa-form">
        <div class="field">
            <div class="name">[`Search`]</div>
            <div class="value">
                <input type="search" name="search" value="{$search|default:''|escape}">
            </div>
        </div>
    </form>


    <table class="zebra" data-transactions>
        <thead>
        <tr>
            <th>Дата</th>
            <th>До</th>
            <th>Сумма</th>
            <th>После</th>
            <th>Номер заказа</th>
            <th>Комментарий</th>
        </tr>
        </thead>
        <tbody>
        {foreach $transactions as $transaction}
        <tr{if $transaction->amount < 0} class="red italic"{/if}>
            <td>{$transaction->datetime|wa_datetime:'humandatetime'}</td>
            <td class="align-right numerical">{$transaction->balance_before|wa_format_number:2}</td>
            <td class="align-right numerical bold">{$transaction->amount|wa_format_number:2}</td>
            <td class="align-right numerical">{$transaction->balance_after|wa_format_number:2}</td>
            <td>{if $transaction->order_id}<a href="#" data-order-id="{$transaction->order_id}">{$transaction->order_id}</a>{/if}</td>
            <td>{$transaction->comment|escape}</td>
        </tr>
        {/foreach}
        </tbody>
    </table>
    {include '../include.pagination.html'
        baseurl='transaction/'
        limit=$limit
        search=$search
        current_page=$current_page
        pagination=$pagination
        start=$start
    inline}
</div>

<script>
    (function(){
        var $transaction_wrapper = $('[data-transactions]');

        $transaction_wrapper.on('click', '[data-order-id]', function (e) {
            e.preventDefault();
            var $this = $(this);

            $('<div>').waDialog({
                url: '?module=transaction&action=info&order_id=' + $this.data('order-id'),
                'buttons': '<a href="#" class="cancel hint">Close</a>'
            });
        })
    })()
</script>